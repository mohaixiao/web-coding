### `Sequelize`基本使用

这段代码使用了 Sequelize 库来连接数据库，并测试连接是否成功。

首先，我们通过 `require` 引入了 Sequelize 库。然后，创建了一个 Sequelize 实例 `sequelize`，并传入了数据库名、用户名、密码和连接参数等信息。其中，`host` 参数指定了数据库服务器的公网 IP 地址，`dialect` 参数指定了使用的数据库类型。在这个例子中，我们使用的是 MySQL 数据库。根据实际需要，您需要根据自己的环境配置这些参数。

接下来，我们使用了一个自执行函数，该函数将尝试使用 `await sequelize.authenticate()` 进行数据库连接测试。如果连接成功，则打印 "数据库链接成功" 的消息；否则，将打印 "数据库链接失败" 的消息，并输出具体错误信息。

需要注意的是，这里使用的是异步函数 `async function()` 和 `await` 关键字来处理异步操作，这使得我们可以避免回调嵌套和使用 Promise 的复杂性，使代码更加简洁易懂。

通常，在这段代码的基础上，我们可以继续编写数据模型定义、数据操作等相关业务代码来完成对数据库的访问和操作。

### 图形验证码

##### 如何区分不同用户的图形验证码？

定义获取用户设备和ip标识，使用md5加密，作为redis的key值的一部分，用来区分

##### 区分不同的场景下的图形验证码？

注册时获取的验证码只能用于注册，不能使用登录。使用一个`type`字段作为`key`值的一部分，用来区分。

### 短信验证码

#### 短信验证码平台选择考虑点

- 各个类型短信价格
- 短信到达率、到达时间
- 短信内容变量灵活，方便支持多场景
- 支持多种推广内容的短信发放，例如业务推广、新产品宣讲、会员关怀等内容的短信
- 多维度数据统计-查看请求量、发送成功量、失败量、等

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-05-07-20-48-55-image.png)

#### 获取手机短信验证码接口开发-常规思路

<img src="file:///C:/Users/mohaixiao/AppData/Roaming/marktext/images/2023-05-07-22-15-11-image.png" title="" alt="" width="503">



第一种使用redis存储60s倒计时和验证码。优化方案：使用redis存在拼接字符串。

```js
 // 获取当前时间拼接验证码
 let randomCodeTime = `${Date.now()}_${randomCode}`
 redisConfig.set(`${type}:code:` + phone, randomCodeTime, 600)
```

优化方案

- 必须保证两个redis操作的原子性
- 同时减少命名空间的浪费

### 手机短信验证码方式开发注册接口

手机号注册查重的逻辑 -> 获取redis缓存的code,判断用户code是否正确 -> 随机获取头像、用户名 -> 加密生成token 7天过期 -> 用户信息插入数据库



### 封装工具类实现返回状态统一管理

使用映射表规范状态码
