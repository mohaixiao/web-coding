### `Sequelize`基本使用

这段代码使用了 Sequelize 库来连接数据库，并测试连接是否成功。

首先，我们通过 `require` 引入了 Sequelize 库。然后，创建了一个 Sequelize 实例 `sequelize`，并传入了数据库名、用户名、密码和连接参数等信息。其中，`host` 参数指定了数据库服务器的公网 IP 地址，`dialect` 参数指定了使用的数据库类型。在这个例子中，我们使用的是 MySQL 数据库。根据实际需要，您需要根据自己的环境配置这些参数。

接下来，我们使用了一个自执行函数，该函数将尝试使用 `await sequelize.authenticate()` 进行数据库连接测试。如果连接成功，则打印 "数据库链接成功" 的消息；否则，将打印 "数据库链接失败" 的消息，并输出具体错误信息。

需要注意的是，这里使用的是异步函数 `async function()` 和 `await` 关键字来处理异步操作，这使得我们可以避免回调嵌套和使用 Promise 的复杂性，使代码更加简洁易懂。

通常，在这段代码的基础上，我们可以继续编写数据模型定义、数据操作等相关业务代码来完成对数据库的访问和操作。

### 图形验证码

##### 如何区分不同用户的图形验证码？

定义获取用户设备和ip标识，使用md5加密，作为redis的key值的一部分，用来区分

##### 区分不同的场景下的图形验证码？

注册时获取的验证码只能用于注册，不能使用登录。使用一个`type`字段作为`key`值的一部分，用来区分。

### 短信验证码

#### 短信验证码平台选择考虑点

- 各个类型短信价格
- 短信到达率、到达时间
- 短信内容变量灵活，方便支持多场景
- 支持多种推广内容的短信发放，例如业务推广、新产品宣讲、会员关怀等内容的短信
- 多维度数据统计-查看请求量、发送成功量、失败量、等

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-05-07-20-48-55-image.png)

#### 获取手机短信验证码接口开发-常规思路

<img src="file:///C:/Users/mohaixiao/AppData/Roaming/marktext/images/2023-05-07-22-15-11-image.png" title="" alt="" width="503">

第一种使用redis存储60s倒计时和验证码。优化方案：使用redis存在拼接字符串。

```js
 // 获取当前时间拼接验证码
 let randomCodeTime = `${Date.now()}_${randomCode}`
 redisConfig.set(`${type}:code:` + phone, randomCodeTime, 600)
```

优化方案

- 必须保证两个redis操作的原子性
- 同时减少命名空间的浪费

### 手机短信验证码方式开发注册接口

手机号注册查重的逻辑 -> 获取redis缓存的code,判断用户code是否正确 -> 随机获取头像、用户名 -> 加密生成token 7天过期 -> 用户信息插入数据库

### 封装工具类实现返回状态统一管理

使用映射表规范状态码

### 小滴云在线教育平台PC端-注册模块开发【前端】

antd ssr闪烁

https://ant.design/docs/react/customize-theme-cn#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93

https://github.com/ant-design/ant-design/issues/41573

前端注册页面倒计时开发

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-05-14-12-55-09-image.png)

倒计时和图形验证码同一组件下，会出现更新倒计时时不断刷新图形验证码，将倒计时设置为子组件实现。更新视图使用useRef使用无效。自定义hooks倒计时，遇到倒计时卡住不动的原因  (不能直接传入一个时间，这样从新渲染之后，又会传入新的时间，一个将要传入的时间用usestate包裹起来，在传入hooks)-> 参考ahooks实现倒计时功能。

## 详解第三方微信登录场景二维码方式接口开发

略

## 面试题：关联查询和多次单表查询哪个更消耗性能？

关联查询 = 笛卡尔积 + 连接条件 + 其他的查询条件 （结果不出现笛卡尔积，但是查询的计算方式还是有笛卡尔积）

**结论**

因此，在数据量大的业务场景下，两个方式的查询性能损耗肯定是关联查询高，应该少用，或者将查询的数据储存在redis缓存

## SQL 安装完成后，关闭mysql 的 ONLY_FULL_GROUP_BY模式（不然线上运行sql中的group by分组语句会报错）

解决方案一：在查询语句中加入所有未聚合的列

这个方案需要修改查询语句，将所有列都加入到Group By子句中，比如将查询语句修改为以下形式：

```
SELECT p.*, c.category_id FROM product p LEFT JOIN category_product c ON c.product_id=p.id GROUP BY p.id, c.category_id ORDER BY p.gmt_create DESC LIMIT 0,12
```

解决方案二：关闭only_full_group_by模式

可以通过修改MySQL的配置文件或者直接在SQL查询中来关闭only_full_group_by模式。

修改MySQL的配置文件方式：

1. 打开MySQL的配置文件，找到 [mysqld] 段落。
2. 在 [mysqld] 段落中添加一行代码：sql_mode=''
3. 保存配置文件并重启MySQL服务。

直接在SQL查询中关闭only_full_group_by模式：

1. 连接MySQL数据库，执行以下命令：

```
SET GLOBAL sql_mode='';
```

注意：该方法需要有足够的权限才能执行。

2. 然后再执行查询语句即可。

注意事项：虽然关闭only_full_group_by模式可以解决问题，但是也会带来潜在的风险，因为它放宽了MySQL数据库对于Group By的限制，可能会导致查询结果不准确。因此建议使用方案一对查询语句进行改进以符合MySQL的标准规范。

## 微信支付最新V3版

#### 微信支付-公众号Appid和商户号绑定指引

https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_7_1.shtml

### 视频播放

播放页面，点开章节自动播放。

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-06-30-15-21-53-image.png)

数据库插入华为云id

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-06-30-16-27-55-image.png)

Uncaught (in promise) DOMException: play() failed because the user didn't interact with the document first.

这个错误通常是由于浏览器的自动播放策略所引起的。大多数现代浏览器要求在播放音频或视频之前，用户必须与页面进行交互。

为了解决这个问题，您可以采取以下措施：

1. 确保音频的播放方法被用户的交互事件触发，例如点击按钮或其他用户操作。
2. 在页面加载完成后，通过一个用户操作（例如点击按钮）来触发音频的播放。
3. 使用浏览器支持的自动播放配置选项，如 `autoplay` 属性或 `muted` 属性。请注意，使用自动播放功能可能会遭到浏览器的阻止，除非用户已与页面进行过有效的交互。

根据具体情况，您可以选择适合您需求和用户体验的解决方案。希望这些提示能帮助您解决该错误。如有其他问题，请随时提问。

Play组件渲染接受的chapterList 是空数组。

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-07-01-12-57-38-image.png)

使用useRef暴露方法

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-07-01-14-22-57-image.png)

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-07-01-14-23-09-image.png)

### children怎么传递参数

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-07-05-20-21-26-image.png)

如果你的子组件是一个`<div>`元素，你可以使用React的`cloneElement`函数来传递props。这样可以将父组件的props传递给子组件。

```jsx
const Danmu = ({ children, ...props }) => {
  // 将父组件的props传递给子组件
  const clonedChildren = React.cloneElement(children, props);

  return (
    <div
      id="container"
      style={{ height: "100%", width: "100%" }}
      className="absolute left-[15%] top-[0%] flex items-center w-[90%] h-[100%]"
    >
      {clonedChildren}
    </div>
  );
};
```

在父组件中，你可以这样使用`Danmu`组件，并传递props给子组件：

```jsx
<Danmu prop1={value1} prop2={value2}>
  <div>
    {/* 子组件的内容 */}
  </div>
</Danmu>
```

在这个例子中，`prop1`和`prop2`会被传递给子组件中的`<div>`元素作为props。你也可以在子组件中使用`props.prop1`和`props.prop2`来获取这些传递的值。



react 先渲染子组件，在渲染父组件，调用下一集是父组件调用，获取最新弹幕是子组件调用，id就不一致。



闭包问题：绑定事件拿不到最新的id

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-07-07-12-39-31-image.png)

使用useLatest获取最新值![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-07-07-12-39-49-image.png)

### 获取视频播放记录接口开发

![](C:\Users\mohaixiao\AppData\Roaming\marktext\images\2023-07-07-14-01-08-image.png)
